(()=>{"use strict";var t={};function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,r(o.key),o)}}function r(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},t.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);const o=function(){return t=function t(e,n,r){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.token=e,this.amount=n,this.pairing=r,this.isExpress=o},(e=[{key:"render",value:function(){this.renderAmount(),this.renderToken(),this.renderQr(),this.adjustGuides()}},{key:"renderAmount",value:function(){var t=document.getElementById("twint-amount");t&&(t.innerHTML=this.amount)}},{key:"renderToken",value:function(){var t=document.getElementById("qr-token");t&&(t.value=this.token)}},{key:"renderQr",value:function(){var t=document.getElementById("qrcode");t.innerHTML="",new QRCode(t,{text:this.token,width:300,height:300,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H})}},{key:"adjustGuides",value:function(){var t=document.getElementById("twint-guide-contact"),e=t.parentElement;this.isExpress?(t.classList.remove("hidden"),e.classList.add("md:grid-cols-2")):(t.classList.add("hidden"),e.classList.remove("md:grid-cols-2"))}}])&&n(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}(),i=window.wp.apiFetch;var c=t.n(i);function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,c,a=[],s=!0,u=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=i.call(n)).done)&&(a.push(r.value),a.length!==e);s=!0);}catch(t){u=!0,o=t}finally{try{if(!s&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(u)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return u(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,f(r.key),r)}}function f(t){var e=function(t,e){if("object"!=a(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==a(e)?e:e+""}const y=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.stages=e,this.start=null},(e=[{key:"begin",value:function(){this.start=new Date}},{key:"interval",value:function(){for(var t=new Date,e=Math.floor((t-this.start)/1e3),n=1e3,r=0,o=Object.entries(this.stages);r<o.length;r++){var i=s(o[r],2),c=i[0],a=i[1];if(!(e>=parseInt(c)))break;n=a}return n}}])&&l(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function p(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,d(r.key),r)}}function b(t,e,n){return(e=d(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d(t){var e=function(t,e){if("object"!=h(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=h(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==h(e)?e:e+""}var v=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.intervalHanlder=new y({0:5e3,5:2e3,600:1e4,3600:0}),this.modal=e,this.processing=!1,this.finished=!1,this.stopped=!1,this.pairing=null,this.callbacks={}}return e=t,n=[{key:"setPairing",value:function(t){this.pairing=t}},{key:"addCallBack",value:function(t,e){this.callbacks[t]=e}},{key:"start",value:function(){this.stopped=!1,this.finished=!1,this.intervalHanlder.begin(),this.modal.isExpress()?this.modal.addCallback(X.EVENT_MODAL_CLOSED,this.onModalClosed.bind(this)):this.modal.addCallback(X.EVENT_MODAL_CLOSED,this.onRegularCheckoutCloseModal.bind(this)),this.onProcessing()}},{key:"onModalClosed",value:function(){if(this.stop(),!this.finished){var t=this;this.cancelPayment((function(e){if(!0!==e.success)return t.check(!0)}))}}},{key:"cancelPayment",value:function(t){this.processing=!0,c()({path:"/twint/v1/payment/cancel",method:"POST",data:{pairingId:this.pairing},cache:"no-store",parse:!1}).then((function(t){if(!t.ok)throw new Error("Network response was not ok");return t.json()})).then((function(e){return t(e)})).catch((function(t){console.error("Error:",t)}))}},{key:"stop",value:function(){this.stopped=!0}},{key:"onProcessing",value:function(){if(this.finished=!1,!this.processing&&!this.stopped){var t=this.intervalHanlder.interval();t>0&&setTimeout(this.check.bind(this),t)}}},{key:"onPaid",value:function(e){this.finished=!0;var n=this.callbacks[t.EVENT_PAID];n&&n(e)}},{key:"onCancelled",value:function(){this.finished=!0;var e=this.callbacks[t.EVENT_CANCELLED];e&&"function"==typeof e&&e()}},{key:"onFinish",value:function(t){return this.finished=!0,t.finish&&"PAID"===t.status?this.onPaid(t):t.finish&&"FAILED"===t.status?this.onCancelled():void 0}},{key:"check",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t||!this.stopped&&!this.processing){var e=this;this.processing=!0,c()({path:"/twint/v1/payment/status",method:"POST",data:{pairingId:this.pairing},cache:"no-store",parse:!1}).then((function(t){if(e.processing=!1,!t.ok)throw new Error("Network response was not ok");return t.json()})).then((function(n){if(!0===n.finish)return e.onFinish(n);!t&&e.onProcessing()})).catch((function(t){e.processing=!1,console.error("Error:",t)}))}}},{key:"onRegularCheckoutCloseModal",value:function(){this.finished||this.cancelPayment((function(t){console.log(t),!0===t.success?location.reload():this.check(!0)}))}}],n&&p(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n}();b(v,"EVENT_CANCELLED","cancelled"),b(v,"EVENT_PAID","paid");const m=v;function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function k(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,w(r.key),r)}}function w(t){var e=function(t,e){if("object"!=g(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=g(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==g(e)?e:e+""}const E=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var e="twint-copy-btn";this.input=document.getElementById("qr-token"),this.button=document.getElementById(e),this.button.addEventListener("click",this.onClick.bind(this)),this.clipboard=new Clipboard("#"+e),this.clipboard.on("success",this.onCopied.bind(this)),this.clipboard.on("error",this.onError.bind(this))},e=[{key:"onClick",value:function(t){t.preventDefault(),this.input.disabled=!1}},{key:"onCopied",value:function(t){t.clearSelection(),this.button.innerHTML=this.button.getAttribute("data-copied"),this.button.classList.add("copied"),this.button.classList.add("border-green-500"),this.button.classList.add("text-green-500"),this.input.disabled=!0,setTimeout(this.reset.bind(this),1e4)}},{key:"onError",value:function(t){console.error("Action:",t.action),console.error("Trigger:",t.trigger)}},{key:"reset",value:function(){this.button.innerHTML=this.button.getAttribute("data-default"),this.button.classList.remove("copied"),this.button.classList.remove("border-green-500"),this.button.classList.remove("text-green-500")}}],e&&k(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function S(t){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S(t)}function P(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,O(r.key),r)}}function O(t){var e=function(t,e){if("object"!=S(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=S(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==S(e)?e:e+""}const j=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},(e=[{key:"init",value:function(){}},{key:"setToken",value:function(t){this.token=t}}])&&P(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function T(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_(r.key),r)}}function _(t){var e=function(t,e){if("object"!=C(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=C(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==C(e)?e:e+""}function L(t,e,n){return e=B(e),function(t,e){if(e&&("object"==C(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,A()?Reflect.construct(e,n||[],B(t).constructor):e.apply(t,n))}function A(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(A=function(){return!!t})()}function B(t){return B=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},B(t)}function D(t,e){return D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},D(t,e)}const I=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=L(this,e)).button=document.getElementById("twint-addroid-button"),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&D(t,e)}(e,t),n=e,(r=[{key:"init",value:function(){this.button&&(this.button.href=this.button.getAttribute("data-href").replace("--TOKEN--",this.token),this.button.click())}}])&&T(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(j);function M(t){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M(t)}function R(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,N(r.key),r)}}function N(t){var e=function(t,e){if("object"!=M(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=M(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==M(e)?e:e+""}function x(t,e,n){return e=V(e),function(t,e){if(e&&("object"==M(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,H()?Reflect.construct(e,n||[],V(t).constructor):e.apply(t,n))}function H(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(H=function(){return!!t})()}function V(t){return V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},V(t)}function Q(t,e){return Q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Q(t,e)}const q=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=x(this,e)).container=document.getElementById("twint-ios-container"),t.registeredEvents=!1,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Q(t,e)}(e,t),n=e,(r=[{key:"init",value:function(){var t=this;this.container&&!this.registeredEvents&&(this.banks=this.container.querySelectorAll("img"),this.banks&&this.banks.forEach((function(e){e.addEventListener("touchend",(function(n){t.onClickedBank(n,e)}))})),this.appLinksElements=this.container.querySelector("select"),this.appLinksElements&&this.appLinksElements.addEventListener("change",this.onChangeAppList.bind(this)),this.registeredEvents=!0)}},{key:"onChangeAppList",value:function(t){var e=t.target,n=e.options[e.selectedIndex].value;this.openAppBank(n)}},{key:"onClickedBank",value:function(t,e){var n=e.getAttribute("data-link");this.openAppBank(n)}},{key:"openAppBank",value:function(t){if(t){t=t.replace("--TOKEN--",this.token);try{window.location.replace(t);var e=setInterval((function(){clearInterval(e)}),2e3)}catch(t){}}}}])&&R(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(j);function K(t){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K(t)}function U(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,G(r.key),r)}}function F(t,e,n){return(e=G(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function G(t){var e=function(t,e){if("object"!=K(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=K(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==K(e)?e:e+""}var Y=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.element=document.getElementById("twint-modal"),this.closeBtn=this.element.querySelector("#twint-close"),this.statusRefresher=new m(this),this.tokenCopier=new E,this.connectors=[],this.connectors.push(new I),this.connectors.push(new q),this.registerEvents(),this.checkout=e,this.callbacks={}}return e=t,n=[{key:"isExpress",value:function(){return this.checkout===t.TYPE_EXPRESS_CHECKOUT}},{key:"getData",value:function(){return{label:this.element.getAttribute("data-exist-label"),message:this.element.getAttribute("data-exist-message")}}},{key:"setContent",value:function(t){this.content=t}},{key:"addCallback",value:function(t,e){"function"==typeof e&&(this.callbacks[t]=e,console.log("callback update"))}},{key:"show",value:function(){var t=this;this.closeBtn.querySelector("span").innerHTML=this.closeBtn.getAttribute("data-default"),this.tokenCopier.reset(),this.content.render(),this.element.classList.remove("!hidden"),this.connectors.forEach((function(e){e.setToken(t.content.token),e.init()})),this.statusRefresher.setPairing(this.content.pairing),this.statusRefresher.addCallBack(m.EVENT_CANCELLED,this.close.bind(this)),this.statusRefresher.addCallBack(m.EVENT_PAID,this.onPaid.bind(this)),this.statusRefresher.start()}},{key:"close",value:function(){this.element.classList.add("!hidden");var e=this.callbacks[t.EVENT_MODAL_CLOSED];e&&e()}},{key:"registerEvents",value:function(){this.closeBtn.addEventListener("click",this.close.bind(this))}},{key:"refreshMiniCart",value:function(){document.body.classList.contains("woocommerce-cart")||(jQuery(document.body).trigger("wc_fragment_refresh"),jQuery(document.body).trigger("added_to_cart"),jQuery(document.body).trigger("removed_from_cart"),jQuery(document.body).trigger("wc-blocks_removed_from_cart"),jQuery(document.body).trigger("wc-blocks_added_to_cart"))}},{key:"onPaid",value:function(t){this.refreshMiniCart(),this.closeBtn.querySelector("span").innerHTML=this.closeBtn.getAttribute("data-success"),location.href=t.extra.redirect}},{key:"continue",value:function(){this.closeBtn.innerHTML=this.closeBtn.getAttribute("data-success")}}],n&&U(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n}();F(Y,"EVENT_MODAL_CLOSED","CLOSED"),F(Y,"TYPE_EXPRESS_CHECKOUT","EC"),F(Y,"TYPE_REGULAR_CHECKOUT","RC");const X=Y;document.addEventListener("DOMContentLoaded",(function(){jQuery("form.checkout").on("checkout_place_order_success",(function(t,e){if(console.log(t,e),"success"===e.result){var n=new X;n.addCallback(X.EVENT_MODAL_CLOSED,(function(){location.reload()}));var r=e.pairingToken,i=e.amount,c=e.pairingId,a=e.currency;n.setContent(new o(r,i+a,c,!1)),n.show()}}))}))})();